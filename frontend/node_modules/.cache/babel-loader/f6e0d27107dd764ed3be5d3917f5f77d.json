{"ast":null,"code":"import axios from \"axios\";\nimport { API_URL } from \"./service.constants\";\nimport { loadState, saveState } from \"../utils/localStorage\";\nimport { checkAuth } from \"./authService\";\nconst $api = axios.create({\n  withCredentials: true,\n  baseURL: API_URL\n});\n$api.interceptors.request.use(config => {\n  const token = loadState(\"token\");\n  config.headers.Authorization = `Bearer ${token}`;\n  return config;\n}, error => console.log(error));\n$api.interceptors.response.use(config => {\n  return config;\n}, async error => {\n  const originalRequest = error.config;\n\n  if (error.response.status === 401 && error.config && !error.config._isRetry) {\n    originalRequest._isRetry = true;\n\n    try {\n      const response = await checkAuth();\n      saveState(\"token\", response.data.accessToken);\n      return $api.request(originalRequest);\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  throw error;\n});\nexport default $api;","map":{"version":3,"names":["axios","API_URL","loadState","saveState","checkAuth","$api","create","withCredentials","baseURL","interceptors","request","use","config","token","headers","Authorization","error","console","log","response","originalRequest","status","_isRetry","data","accessToken"],"sources":["C:/Users/ASUS/Documents/Car-trade-app/frontend/src/services/config.js"],"sourcesContent":["import axios from \"axios\";\r\nimport { API_URL } from \"./service.constants\";\r\nimport { loadState, saveState } from \"../utils/localStorage\";\r\nimport { checkAuth } from \"./authService\";\r\nconst $api = axios.create({\r\n  withCredentials: true,\r\n  baseURL: API_URL,\r\n});\r\n\r\n$api.interceptors.request.use(\r\n  (config) => {\r\n    const token = loadState(\"token\");\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n    return config;\r\n  },\r\n  (error) => console.log(error)\r\n);\r\n\r\n$api.interceptors.response.use(\r\n  (config) => {\r\n    return config;\r\n  },\r\n  async (error) => {\r\n    const originalRequest = error.config;\r\n    if (\r\n      error.response.status === 401 &&\r\n      error.config &&\r\n      !error.config._isRetry\r\n    ) {\r\n      originalRequest._isRetry = true;\r\n      try {\r\n        const response = await checkAuth();\r\n        saveState(\"token\", response.data.accessToken);\r\n        return $api.request(originalRequest);\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n    }\r\n    throw error;\r\n  }\r\n);\r\n\r\nexport default $api;\r\n"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,OAAT,QAAwB,qBAAxB;AACA,SAASC,SAAT,EAAoBC,SAApB,QAAqC,uBAArC;AACA,SAASC,SAAT,QAA0B,eAA1B;AACA,MAAMC,IAAI,GAAGL,KAAK,CAACM,MAAN,CAAa;EACxBC,eAAe,EAAE,IADO;EAExBC,OAAO,EAAEP;AAFe,CAAb,CAAb;AAKAI,IAAI,CAACI,YAAL,CAAkBC,OAAlB,CAA0BC,GAA1B,CACGC,MAAD,IAAY;EACV,MAAMC,KAAK,GAAGX,SAAS,CAAC,OAAD,CAAvB;EACAU,MAAM,CAACE,OAAP,CAAeC,aAAf,GAAgC,UAASF,KAAM,EAA/C;EACA,OAAOD,MAAP;AACD,CALH,EAMGI,KAAD,IAAWC,OAAO,CAACC,GAAR,CAAYF,KAAZ,CANb;AASAX,IAAI,CAACI,YAAL,CAAkBU,QAAlB,CAA2BR,GAA3B,CACGC,MAAD,IAAY;EACV,OAAOA,MAAP;AACD,CAHH,EAIE,MAAOI,KAAP,IAAiB;EACf,MAAMI,eAAe,GAAGJ,KAAK,CAACJ,MAA9B;;EACA,IACEI,KAAK,CAACG,QAAN,CAAeE,MAAf,KAA0B,GAA1B,IACAL,KAAK,CAACJ,MADN,IAEA,CAACI,KAAK,CAACJ,MAAN,CAAaU,QAHhB,EAIE;IACAF,eAAe,CAACE,QAAhB,GAA2B,IAA3B;;IACA,IAAI;MACF,MAAMH,QAAQ,GAAG,MAAMf,SAAS,EAAhC;MACAD,SAAS,CAAC,OAAD,EAAUgB,QAAQ,CAACI,IAAT,CAAcC,WAAxB,CAAT;MACA,OAAOnB,IAAI,CAACK,OAAL,CAAaU,eAAb,CAAP;IACD,CAJD,CAIE,OAAOJ,KAAP,EAAc;MACdC,OAAO,CAACC,GAAR,CAAYF,KAAZ;IACD;EACF;;EACD,MAAMA,KAAN;AACD,CArBH;AAwBA,eAAeX,IAAf"},"metadata":{},"sourceType":"module"}